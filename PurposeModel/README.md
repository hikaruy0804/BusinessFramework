# 🎨 パーパスモデル作成Webアプリケーション

## 1. サービス概要

| 項目     | 内容                                                       |
| ------ | -------------------------------------------------------- |
| 名称     | Purpose Model Creator                                    |
| 目的     | 共通目的を中心に、関与者の「目的」「役割」「名前」をビジュアルに整理し、関係性を直感的に把握できる共創設計図を作成する |
| 想定ユーザー | 行政職員・NPO職員・企業のプロジェクト担当者・住民・研究者・ファシリテーターなど                |
| 実行環境   | HTML/CSS/JSのみ（サーバ通信不要、ローカル利用可）                           |
| 保存形式   | JSON（再編集可）、PNG（共有・出力用）                               |

---

## 2. デザイン仕様

### 📌 基本構成

*   **中央：共通目的**（タイトル＋補足説明、10文字程度で自動折り返し）
*   **外周：ステークホルダー**（円弧セクションに分割）
*   **上半分**：共創に関与するステークホルダー（Supporting）
*   **下半分**：主体的な共創パートナー（Leading）
*   **円弧構成**：目的（内側2/3・明るい色）→ 役割（外側1/3・薄い色）→ 名前（円の外側）

### 🎨 デザイン指針

| 要素     | 指針                                           |
| ------ | -------------------------------------------- |
| 配色     | レトロモダンな鮮やかな色調（企業：グリーン、行政：イエロー、住民：コーラルオレンジ、専門家：ブルー） |
| 配置     | 円形グリッドに沿って自動整列。各要素はダブルクリックで編集可能。 |
| フォント   | Noto Sans JP（目的タイトル: 20px太字、目的説明: 16px、その他: 18px） |
| UI      | レトロモダンなフラットデザイン（ウォームホワイト背景、ダークグリーングレー文字） |

---

## 3. 主な機能一覧

### 🔄 モード機能
| モード | 説明 | 時間軸メニュー | データ管理 |
|--------|------|---------------|-----------|
| **単体** | シンプルな単一モデル作成 | グレーアウト（選択不可） | 時系列「現在」と共有 |
| **時系列** | 時間軸での変化を管理 | 選択可能 | 時系列ごとに独立 |
| **比較** | 複数の比較対象を管理 | 非表示 | 比較対象ごとに完全分離 |

### 📊 データ管理機能
| 機能              | 内容                                  |
| --------------- | ----------------------------------- |
| ✅ **3つのモード管理** | 単体・時系列・比較の3つのモードで異なる用途に対応 |
| ✅ **時間軸管理**        | 現在・過去・数年先・将来の4つの時間軸でパーパスモデルを管理・切り替え |
| ✅ **比較対象管理**      | 複数の比較対象（競合他社、類似事例など）を独立して管理 |
| ✅ **データ共有構造**    | 単体モードと時系列「現在」は同じデータを共有、比較は完全分離 |

### 🎯 編集機能
| 機能              | 内容                                  |
| --------------- | ----------------------------------- |
| ✅ **パーパス入力**        | 中央円のタイトル・補足説明を入力（10文字自動折り返し） |
| ✅ **ステークホルダー追加**    | 「名前」「役割」「目的」「カテゴリ」「配置位置（上/下）」を入力し追加 |
| ✅ **自動配置 & 編集**     | カテゴリごとにセクションへ自動配置。各要素はダブルクリックでテキスト編集可能 |
| ✅ **階層的色分け**      | カテゴリ色を基準に、「目的・役割」の階層を明るい色→薄い色で表示 |
| ✅ **削除機能**         | ステークホルダーの削除機能（編集モーダルから実行） |
| ✅ **入力検証**         | 適切な表示のための文字数制限と入力チェック |

### 💾 データ永続化機能
| 機能              | 内容                                  |
| --------------- | ----------------------------------- |
| ✅ **自動保存**         | LocalStorageによる自動保存・復元機能 |
| ✅ **JSON出力・読み込み**   | ファイル保存形式で編集内容を出力・読み込みして再編集可能 |
| ✅ **PNGエクスポート**    | 現在の画面を1000×800pxの画像として出力、資料などで利用可能 |
| ✅ **新規作成**         | 全データをリセットして新規プロジェクト開始 |

### 🎨 UI/UX機能
| 機能              | 内容                                  |
| --------------- | ----------------------------------- |
| ✅ **SVG描画**         | ラベル・円弧など全てSVGで描画（リアルタイム更新・アニメーション付き） |
| ✅ **レスポンシブ対応**     | モバイル端末でも利用可能なハンバーガーメニュー |
| ✅ **カスタムモーダルダイアログ** | 編集、確認、通知用のカスタムダイアログで直感的な操作を提供 |
| ✅ **統一デザイン**      | 全UI要素で統一されたレトロモダンデザイン |

---

## 4. データ構造とモード管理

### 📁 データ共有構造

```
データ管理構造:
├─ timelineData (時系列データ)
│  ├─ current (現在) ← 単体モードと共有
│  ├─ past (過去)
│  ├─ near-future (数年先)
│  └─ future (将来)
└─ comparisonData (比較データ - 完全分離)
   ├─ [比較名称1] (例: 競合A)
   ├─ [比較名称2] (例: 競合B)
   └─ [比較名称3] (例: 自社)
```

### 🔄 モード別動作

| モード | データ参照先 | 時間軸表示 | 追加ラベル |
|--------|-------------|-----------|-----------|
| **単体** | `timelineData['current']` | グレーアウト | なし |
| **時系列** | `timelineData[選択された時系列]` | 選択可能 | 時系列名称 |
| **比較** | `comparisonData[選択された比較名称]` | 非表示 | 比較名称 |

---

## 5. JSONデータ構造（完全版）

```json
{
  "currentTimeline": "current",
  "currentMode": "timeline",
  "comparisonList": ["競合A", "競合B", "自社"],
  "selectedComparison": "競合A",
  "timelineData": {
    "current": {
      "purpose": {
        "title": "パーパス（共通目的）",
        "description": "このプロジェクトで実現したい価値"
      },
      "stakeholders": [
        {
          "id": "uuid-xxxx",
          "name": "大学・研究機関",
          "role": "分析支援",
          "goal": "地域課題の見える化",
          "category": "expert",
          "layer": "supporting"
        }
      ]
    },
    "past": { /* ... */ },
    "near-future": { /* ... */ },
    "future": { /* ... */ }
  },
  "comparisonData": {
    "競合A": {
      "purpose": { /* ... */ },
      "stakeholders": [ /* ... */ ]
    },
    "競合B": {
      "purpose": { /* ... */ },
      "stakeholders": [ /* ... */ ]
    },
    "自社": {
      "purpose": { /* ... */ },
      "stakeholders": [ /* ... */ ]
    }
  }
}
```

**データ項目説明**:
*   `category`: `"company"` / `"government"` / `"citizen"` / `"expert"`
*   `layer`: `"supporting"` / `"leading"`

---

## 6. 画面構成

```
+-------------------------------------------------------------+
| ① ヘッダー (レスポンシブ対応：ハンバーガーメニュー)         |
| [新規作成] [データ読込] [データ保存] [PNG出力]              |
+-------------------------------------------------------------+

+--------------------------+----------------------------------+
| ② 編集フォーム          | ③ パーパスモデル図（SVG領域）     |
|--------------------------|----------------------------------|
| モード選択               | [円形レイアウト：カテゴリごとに色分け]|
| [単体][時系列][比較]     | ・中央：タイトル＋説明（10文字折返）|
|                          | ・円弧：目的2/3（明るい） + 役割1/3（薄い）|
| 時間軸 (モードにより制御) | ・外側：名前（太字）             |
| ・現在/過去/数年先/将来   | ・ダブルクリックでテキスト編集     |
|                          | ・上段：「共創のステークホルダー」ラベル|
| 比較名称 (比較モード時)   | ・下段：「主体のステークホルダー」ラベル|
| ・入力フィールド + 追加   | ・追加ラベル：(現在)/(比較名称)   |
| ・削除可能ドロップダウン   |                                  |
|                          |                                  |
| ステークホルダー追加フォーム |                                  |
| ・名前・役割・目的       |                                  |
| ・カテゴリ・配置選択     |                                  |
+--------------------------+----------------------------------+
```

---

## 7. 実装技術

| 項目           | 内容                                           |
| ------------ | -------------------------------------------- |
| `index.html` | メイン画面（全モード対応）                          |
| `style.css`  | レトロモダンデザイン、円形グリッド、レスポンシブ対応、統一UI |
| `script.js`  | 全機能処理、3モード管理、LocalStorage管理、データ分離制御 |
| 使用ライブラリ  | `d3.js` v7 (SVG描画), `FileSaver.js` (ファイル保存), `uuid` (ID生成) |

---

## 8. ファイル構成

```
purpose/
├─ index.html           # メイン画面（全モード対応）
├─ style.css            # 統一デザイン（レトロモダン）
├─ script.js            # 全機能処理（3モード管理）
├─ README.md            # 本ドキュメント
└─ old/                 # 旧ファイル・作業用ファイル保管
    ├─ sample.html      # 旧サンプル付きファイル
    ├─ start.html       # 旧選択画面
    ├─ script-sample.js # 旧サンプル用スクリプト
    └─ ...              # その他の旧ファイル
```

---

## 9. 出力ファイル形式

| 種別      | 用途                 | サイズ | 内容 |
| ------- | ------------------ | ----- | ---- |
| `.json` | 再編集用保存形式 | - | 全モード・全データを含む完全なデータ構造 |
| `.png`  | 画像出力（印刷・SNS共有用） | 1000×800px | 現在表示中のパーパスモデル図 |

---

## 10. カラーパレット

| カテゴリ | 色コード | 色名 | 内側（目的） | 外側（役割） |
| ------ | ------- | --- | ----------- | ----------- |
| 企業 | #69DB7C | グリーン | 少し暗いグリーン | 薄いグリーン |
| 行政 | #FFD43B | イエロー | 少し暗いイエロー | 薄いイエロー |
| 住民 | #FF8A65 | コーラルオレンジ | 少し暗いオレンジ | 薄いオレンジ |
| 専門家 | #5C7CFA | ブルー | 少し暗いブルー | 薄いブルー |
| UI背景 | #F4F3EE | ウォームホワイト | - | - |
| UI文字 | #2F3E46 | ダークグリーングレー | - | - |

---

## 11. 使用方法

### 🚀 基本的な使い方

1. **ブラウザでindex.htmlを開く**
2. **モード選択**: 用途に応じて「単体」「時系列」「比較」を選択
3. **データ入力**: パーパス（共通目的）とステークホルダーを入力
4. **編集**: 円弧上の要素をダブルクリックで直接編集
5. **保存**: JSON形式で保存、または画像出力

### 📋 モード別使用方法

#### 🎯 単体モード
- **用途**: シンプルな単一プロジェクトのパーパスモデル作成
- **操作**: パーパスとステークホルダーを入力するだけ
- **特徴**: 時系列選択は無効、最もシンプルな操作

#### ⏰ 時系列モード
- **用途**: プロジェクトの時間的変化を管理
- **操作**: 
  1. 時間軸（現在・過去・数年先・将来）を選択
  2. 各時間軸でパーパスとステークホルダーを入力
  3. 時間軸を切り替えて変化を確認
- **特徴**: 「現在」は単体モードと同じデータを共有

#### 🔄 比較モード
- **用途**: 競合他社、類似事例、複数案の比較検討
- **操作**:
  1. 比較名称を入力して「追加」ボタンをクリック
  2. ドロップダウンから比較対象を選択
  3. 各比較対象でパーパスとステークホルダーを入力
  4. 比較対象を切り替えて違いを確認
- **特徴**: 各比較対象は完全に独立したデータ

### 💡 便利な機能

- **自動保存**: 編集内容は自動的にLocalStorageに保存
- **ダブルクリック編集**: 円弧上の要素を直接編集可能
- **削除機能**: 編集モーダルから不要なステークホルダーを削除
- **入力検証**: 文字数制限と必須項目チェック
- **エラー防止**: 比較モードで比較名称未選択時の操作を防止

---

## 12. 特徴

### 🎯 **多様な用途に対応**
*   **単体**: シンプルなプロジェクト管理
*   **時系列**: プロジェクトの変化追跡
*   **比較**: 競合分析・複数案検討

### 🔧 **技術的特徴**
*   **サーバー不要**：完全にクライアントサイドで動作
*   **データ分離**：各モードで適切にデータを分離・共有管理
*   **直感的操作**：ダブルクリック編集、リアルタイム更新、カスタムモーダルダイアログ

### 🎨 **デザイン特徴**
*   **レトロモダンデザイン**：温かみのある色調と洗練されたUI
*   **高い可読性**：適切なフォントサイズとコントラスト、階層的色分け
*   **統一感**：全UI要素で一貫したデザイン言語

### 💾 **データ管理特徴**
*   **柔軟な出力**：JSON再編集、PNG画像出力対応
*   **データ永続化**：LocalStorageによる自動保存で画面更新後もデータ保持
*   **完全なデータ構造**：全モード・全データを含む包括的なJSON形式

---

## 13. 技術的詳細

### 🔧 データ管理アーキテクチャ
- **3層データ構造**: モード管理、時系列データ、比較データの分離
- **自動保存**: 入力・編集・削除時の即座なLocalStorage保存
- **データ整合性**: 画面更新・PNG出力後もデータ保持
- **エラーハンドリング**: 不正操作の防止とユーザーフレンドリーなエラー表示

### 🎨 描画・UI技術
- **SVGベース**: スケーラブルで高品質な描画
- **D3.js活用**: データドリブンなビジュアライゼーション
- **アニメーション**: 要素追加・削除時のスムーズなアニメーション
- **レスポンシブ**: モバイル対応のハンバーガーメニュー

### 💾 出力機能技術
- **PNG出力**: Canvas APIを使用した正確な画像生成
- **JSON出力**: 完全な再編集可能形式
- **データ保護**: 出力処理中のデータ保持とエラーハンドリング

---
